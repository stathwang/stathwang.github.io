<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://stathwang.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://stathwang.github.io/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://stathwang.github.io/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://stathwang.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Seong Hyun Hwang Atom">



  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="author" content="Seong Hyun Hwang" />
<meta name="description" content="Spatial Statistics The field of spatial statistics is experiencing a period of rapid growth, though less so compared to that of machine learning and artificial intelligence, with the onset of location technology and efficient solution techniques for high performance computing that augments many classical frequentist inference procedures developed years ago …" />
<meta name="keywords" content="point process models, spatial statistics, r">
<meta property="og:site_name" content="Seong Hyun Hwang"/>
<meta property="og:title" content="Predicting Free Public WiFi Locations in Seoul with Point Process Models using Foursquare API"/>
<meta property="og:description" content="Spatial Statistics The field of spatial statistics is experiencing a period of rapid growth, though less so compared to that of machine learning and artificial intelligence, with the onset of location technology and efficient solution techniques for high performance computing that augments many classical frequentist inference procedures developed years ago …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://stathwang.github.io/predicting-free-public-wifi-locations-in-seoul-with-point-process-models-using-foursquare-api.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-06-25 01:45:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://stathwang.github.io/author/seong-hyun-hwang.html">
<meta property="article:section" content="Spatial Statistics"/>
<meta property="article:tag" content="point process models"/>
<meta property="article:tag" content="spatial statistics"/>
<meta property="article:tag" content="r"/>
<meta property="og:image" content="http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg">
  <title>Seong Hyun Hwang &ndash; Predicting Free Public WiFi Locations in Seoul with Point Process Models using Foursquare API</title>
</head>
<body>
  <aside>
    <div>
      <a href="https://stathwang.github.io">
        <img src="http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg" alt="Seong Hyun Hwang" title="Seong Hyun Hwang">
      </a>
      <h1><a href="https://stathwang.github.io">Seong Hyun Hwang</a></h1>
<p>Data Scientist - Product Developer</p>      <nav>
        <ul class="list">
          <li><a href="https://stathwang.github.io/pages/about.html#about">about</a></li>
          <li><a href="https://stathwang.github.io/pages/photos.html#photos">photos</a></li>
          <li><a href="https://stathwang.github.io/pages/projects.html#projects">projects</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-github" href="https://github.com/stathwang" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-google" href="https://plus.google.com/112356517445062778569" target="_blank"><i class="fa fa-google"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/superhugehwang" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-rss" href="//stathwang.github.io/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="https://stathwang.github.io">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
      <a href="https://stathwang.github.io/feeds/all.atom.xml">Atom</a>
    </nav>

<article>
  <header>
    <h1 id="predicting-free-public-wifi-locations-in-seoul-with-point-process-models-using-foursquare-api">Predicting Free Public WiFi Locations in Seoul with Point Process Models using Foursquare API</h1>
    <p>Posted on June 25 2017 in <a href="https://stathwang.github.io/category/spatial-statistics.html">Spatial Statistics</a></p>
  </header>
  <div>
    <h3>Spatial Statistics</h3>
<p>The field of spatial statistics is experiencing a period of rapid growth, though less so compared to that of machine learning and artificial intelligence, with the onset of location technology and efficient solution techniques for high performance computing that augments many classical frequentist inference procedures developed years ago with Bayesian methods. </p>
<p>A point process, in particular, is a special kind of stochastic process where each <span class="math">\(X_i\)</span> is the numeric representation of a point location in space, usually planar. Diggle (2013) puts it nicely: <em>"A spatial point pattern is a set of locations, irregularly distributed within a designated region and presumed to have been generated by some form of stochastic mechanism (p. xxix)"</em>. The equivalent of a linear model in spatial statistics is a <strong>point process model</strong> that takes into account xy-coordinates of a point and </p>
<p>In this post, I'm going to fit point process models on the dataset of free public WiFi locations in Seoul, Korea downloaded from <a href="http://data.seoul.go.kr/">Seoul Open Data Plaza</a> and predict the probability of having a free public WiFi at a given location within Seoul using location data grabbed from the <a href="https://developer.foursquare.com/">Foursquare API</a>.</p>
<h3>WiFi Location Dataset</h3>
<p>The dataset <code>seoul-public-wifi-cleaned.csv</code> consists of 2385 spatial points with 6 columns that are the name of the place where a free public WiFi is installed, xy-coordinate (longitude and latitude) of the place, WiFi network provider, municipal unit, and location type. Each point can be one of 3 WiFi network providers: KT, SKT, and LGU+ and one of 12 location types: bus stops, community centers, cultural facilities, health facilities, main streets, parks, plazas, public institutions, tourist destinations, traditional markets, walking trails, and welfare facilities.</p>
<div class="highlight"><pre><span></span><span class="n">library</span><span class="p">(</span><span class="n">RCurl</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">jsonlite</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">spdep</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">splancs</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">spatstat</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span>

<span class="n">wifi</span> <span class="o">&lt;-</span> <span class="n">fread</span><span class="p">(</span><span class="s2">&quot;seoul-public-wifi-cleaned.csv&quot;</span><span class="p">)</span>
</pre></div>


<p>The distribution of WiFi network providers and that of location categories are plotted as follows. I borrowed the <a href="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/">multiplot</a> function to plot two graphs in a single window.</p>
<p><img alt="wifiplots" src="https://stathwang.github.io/images/wifiplots.png"></p>
<div class="highlight"><pre><span></span><span class="n">w1</span> <span class="o">&lt;-</span> <span class="n">wifi</span><span class="p">[,</span> <span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">cat</span><span class="p">][</span><span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">)]</span>
<span class="n">w2</span> <span class="o">&lt;-</span> <span class="n">wifi</span><span class="p">[,</span> <span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">comp</span><span class="p">][</span><span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">)]</span>
<span class="n">w1</span><span class="err">$</span><span class="n">cat</span> <span class="o">&lt;-</span> <span class="n">factor</span><span class="p">(</span><span class="n">w1</span><span class="err">$</span><span class="n">cat</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">rev</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">character</span><span class="p">(</span><span class="n">w1</span><span class="err">$</span><span class="n">cat</span><span class="p">)))</span>
<span class="n">w2</span><span class="err">$</span><span class="n">comp</span> <span class="o">&lt;-</span> <span class="n">factor</span><span class="p">(</span><span class="n">w2</span><span class="err">$</span><span class="n">comp</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="k">as</span><span class="o">.</span><span class="n">character</span><span class="p">(</span><span class="n">w2</span><span class="err">$</span><span class="n">comp</span><span class="p">))</span>
<span class="n">p1</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">w1</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">cat</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">N</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span> <span class="o">=</span> <span class="s2">&quot;identity&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">coord_flip</span><span class="p">()</span> <span class="o">+</span> 
  <span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">N</span><span class="p">),</span> <span class="n">position</span> <span class="o">=</span> <span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">hjust</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Number of Spatial Points&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Location Types&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Barplot of Location Types&quot;</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">w2</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">comp</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">N</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span> <span class="o">=</span> <span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">N</span><span class="p">),</span> <span class="n">position</span> <span class="o">=</span> <span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">vjust</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;WiFi Network Providers&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Number of Spatial Points&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Barplot of WiFi Network Providers&quot;</span><span class="p">)</span>
<span class="n">multiplot</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>


<p>Spatially join the points with the Seoul municipalities shapefiles and plot the points on top of municipality unit boundaries. Also plot the points and contours of a 2D kernel density estimate on the actual map of Seoul.</p>
<div class="highlight"><pre><span></span><span class="n">shape</span> <span class="o">&lt;-</span> <span class="n">readOGR</span><span class="p">(</span><span class="s2">&quot;/Users/seonghwang/Downloads/seoul_municipalities.shp&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

<span class="n">kt</span><span class="o">.</span><span class="n">list</span> <span class="o">&lt;-</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">shape</span><span class="nd">@polygons</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">kt</span> <span class="o">&lt;-</span> <span class="n">shape</span><span class="nd">@polygons</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="nd">@Polygons</span><span class="p">[[</span><span class="mi">1</span><span class="p">]]</span><span class="nd">@coords</span>
  <span class="n">kt</span><span class="o">.</span><span class="n">list</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">kt</span>
<span class="p">}</span>

<span class="n">kt</span><span class="o">.</span><span class="n">list</span> <span class="o">&lt;-</span> <span class="n">do</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span> <span class="n">kt</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>

<span class="n">wifi</span><span class="o">.</span><span class="n">pts</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">points</span><span class="p">(</span><span class="n">wifi</span><span class="err">$</span><span class="n">lng</span><span class="p">,</span> <span class="n">wifi</span><span class="err">$</span><span class="n">lat</span><span class="p">)</span>
<span class="n">wifi</span><span class="o">.</span><span class="n">poly</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">points</span><span class="p">(</span><span class="n">kt</span><span class="o">.</span><span class="n">list</span><span class="p">[,</span><span class="mi">1</span><span class="p">],</span> <span class="n">kt</span><span class="o">.</span><span class="n">list</span><span class="p">[,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">wfppp</span> <span class="o">&lt;-</span> <span class="n">ppp</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">pts</span><span class="p">[,</span><span class="mi">1</span><span class="p">],</span> <span class="n">wifi</span><span class="o">.</span><span class="n">pts</span><span class="p">[,</span><span class="mi">2</span><span class="p">],</span>
             <span class="nb">xrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">poly</span><span class="p">[,</span><span class="mi">1</span><span class="p">]),</span>
             <span class="n">yrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">poly</span><span class="p">[,</span><span class="mi">2</span><span class="p">]))</span>

<span class="n">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">pts</span><span class="p">[,</span><span class="mi">1</span><span class="p">],</span> <span class="n">wifi</span><span class="o">.</span><span class="n">pts</span><span class="p">[,</span><span class="mi">2</span><span class="p">],</span> <span class="n">pch</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">cex</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">)</span>
<span class="n">polymap</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">poly</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>

<span class="n">seoul_map</span> <span class="o">&lt;-</span> <span class="n">qmap</span><span class="p">(</span><span class="s1">&#39;seoul&#39;</span><span class="p">,</span> <span class="n">zoom</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> <span class="n">maptype</span> <span class="o">=</span> <span class="s1">&#39;roadmap&#39;</span><span class="p">)</span>
<span class="n">q</span> <span class="o">&lt;-</span> <span class="n">seoul_map</span> <span class="o">+</span> 
  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">wifi</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lng</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">geom_polygon</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">wifi</span><span class="p">,</span>
               <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lng</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="o">..</span><span class="n">level</span><span class="o">..</span><span class="p">),</span>
               <span class="n">stat</span> <span class="o">=</span> <span class="s1">&#39;density2d&#39;</span><span class="p">,</span>
               <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</pre></div>


<p><img alt="singleplot" src="https://stathwang.github.io/images/singleplot.png"></p>
<p>Are the points clustered, regular, or random? A clustered process means that events, or actual observations, fall into clumped groupings, whereas in a regular process, there are regular spatial intervals between events i.e. if species are pushing against each other by inhibiting growth at too close a distance. Events follow a <strong>completely spatially random</strong> pattern where events are equally likely to occur at any location within the defined region <span class="math">\(R\)</span>. The CSR serves as the baseline for comparison of clustered and regular point processes.</p>
<p>Given a CSR, events follow a uniform distribution over the study region <span class="math">\(R\)</span>:</p>
<div class="math">\begin{equation}
f(x, y) = \dfrac{1}{|R|}
\end{equation}</div>
<p>for all <span class="math">\((x, y) \in R\)</span>, where <span class="math">\(|R|\)</span> is the area of <span class="math">\(R\)</span>. Events are also independent of each other. Note that since the area of <span class="math">\(R\)</span> may vary widely, it’s sometimes more helpful to think that the average number of points per unit area is some fixed, constant <span class="math">\(\lambda\)</span> (lambda): this number is called the intensity, also the mean. </p>
<p>Poisson distributions are used to model the number of events per unit of space or time. The mean and the variance of a Poisson distribution are all equal to <span class="math">\(\lambda\)</span>. A <em>homogenous Poisson point process</em> is defined as follows:</p>
<ul>
<li>The random number of events <span class="math">\(X\)</span> in a finite region <span class="math">\(A\)</span> has a Poisson distribution with mean <span class="math">\(\lambda|A|* where $|A|\)</span> is the area of <span class="math">\(A\)</span> and <span class="math">\(\lambda\)</span> is the intensity.</li>
</ul>
<p><strong>Intensity</strong> is the number of expected events per unit area. For a homogenous process, this is constant over the area.</p>
<ul>
<li>Given that a total of <span class="math">\(X = N\)</span> events occur in <span class="math">\(A\)</span>, the locations of the events are uniformly distributed across <span class="math">\(A\)</span>.</li>
</ul>
<p>This means that for a CSR, while the observed number of points over a region <span class="math">\(R\)</span> will vary from one realization to the next, the average (expected) number of points is the fixed quantity $\lambda|R|*. We can therefore generate a CSR:</p>
<ol>
<li>Generate a Poisson number of points <span class="math">\(X = N\)</span> with mean <span class="math">\(\lambda|R|\)</span>.</li>
<li>Randomly assign locations for the <span class="math">\(N\)</span> according to a uniform distribution.</li>
</ol>
<p>Several measures exist: nearest neighbor methods (G, F). However, most common and popular is K function.
We can check this using the plot of K, L, G, F and J functions.</p>
<div class="highlight"><pre><span></span><span class="c1"># K, L, G, F, J functions</span>
<span class="n">wf</span><span class="o">.</span><span class="n">env</span> <span class="o">&lt;-</span> <span class="n">envelope</span><span class="p">(</span><span class="n">wfppp</span><span class="p">,</span> <span class="n">fun</span> <span class="o">=</span> <span class="n">Kest</span><span class="p">)</span>
<span class="n">wf</span><span class="o">.</span><span class="n">K</span> <span class="o">&lt;-</span> <span class="n">Kest</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span>
<span class="n">Kplot</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">wf</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">datatitle</span> <span class="o">=</span> <span class="s2">&quot;Wi-Fi Locations&quot;</span><span class="p">)</span>
<span class="n">L</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">wf</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">datatitle</span> <span class="o">=</span> <span class="s2">&quot;Wi-Fi Locations&quot;</span><span class="p">)</span>

<span class="n">wf</span><span class="o">.</span><span class="n">env</span> <span class="o">&lt;-</span> <span class="n">envelope</span><span class="p">(</span><span class="n">wfppp</span><span class="p">,</span> <span class="n">fun</span> <span class="o">=</span> <span class="n">Gest</span><span class="p">)</span>
<span class="n">wf</span><span class="o">.</span><span class="n">G</span> <span class="o">&lt;-</span> <span class="n">Gest</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span>
<span class="n">G</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">wf</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">)</span>

<span class="n">wf</span><span class="o">.</span><span class="n">env</span> <span class="o">&lt;-</span> <span class="n">envelope</span><span class="p">(</span><span class="n">wfppp</span><span class="p">,</span> <span class="n">fun</span> <span class="o">=</span> <span class="n">Fest</span><span class="p">)</span>
<span class="n">wf</span><span class="o">.</span><span class="n">F</span> <span class="o">&lt;-</span> <span class="n">Fest</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span>
<span class="n">Ffunc</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">wf</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span>

<span class="n">wf</span><span class="o">.</span><span class="n">env</span> <span class="o">&lt;-</span> <span class="n">envelope</span><span class="p">(</span><span class="n">wfppp</span><span class="p">,</span> <span class="n">fun</span> <span class="o">=</span> <span class="n">Jest</span><span class="p">)</span>
<span class="n">wf</span><span class="o">.</span><span class="n">J</span> <span class="o">&lt;-</span> <span class="n">Jest</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span>
<span class="n">Jfunc</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">wf</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="n">xlims</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span> <span class="n">ylims</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">datatitle</span> <span class="o">=</span> <span class="s2">&quot;J&quot;</span><span class="p">)</span>
</pre></div>


<p>Since each spatial point is marked by two factors: WiFi network providers and WiFi location types, we have a marked point process. We can examine relationships between a particular group and all other groups i.e. multi-group comparison.</p>
<p>Here we observe that KT WiFi locations are mainly concentrated near the north of the river, while SKTs are concentrated near the south of the river. LGU+ covers a wider range around the center of Seoul.</p>
<p><img alt="w11" src="https://stathwang.github.io/images/WiFi-Locations-Part.png">
<img alt="w12" src="https://stathwang.github.io/images/WiFi-Locations-Part2.png"></p>
<div class="highlight"><pre><span></span><span class="c1"># Marked point process</span>
<span class="n">wfact</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">wifi</span><span class="err">$</span><span class="n">comp</span><span class="p">)</span>
<span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span> <span class="o">&lt;-</span> <span class="n">ppp</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">pts</span><span class="p">[,</span><span class="mi">1</span><span class="p">],</span> <span class="n">wifi</span><span class="o">.</span><span class="n">pts</span><span class="p">[,</span><span class="mi">2</span><span class="p">],</span> 
                 <span class="nb">xrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">poly</span><span class="p">[,</span><span class="mi">1</span><span class="p">]),</span>
                 <span class="n">yrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">poly</span><span class="p">[,</span><span class="mi">2</span><span class="p">]),</span>
                 <span class="n">marks</span> <span class="o">=</span> <span class="n">wfact</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span><span class="p">),</span> <span class="n">chars</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span><span class="p">)),</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">),</span> <span class="n">ribbon</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>

<span class="c1"># Relative risk</span>
<span class="n">mainerr</span> <span class="o">=</span> <span class="n">relrisk</span><span class="p">(</span><span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">mainerr</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s2">&quot;Relative Risk by WiFi Network Providers&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mainerr</span><span class="p">,</span> <span class="n">which</span><span class="o">.</span><span class="n">max</span><span class="p">),</span> <span class="n">main</span> <span class="o">=</span> <span class="s2">&quot;Most Common WiFi Network Providers&quot;</span><span class="p">)</span>

<span class="c1"># Plot Gdot, Kdot, and Ldot from one to many</span>
<span class="n">plot</span><span class="p">(</span><span class="n">Gdot</span><span class="p">(</span><span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span><span class="p">,</span> <span class="s2">&quot;LGU+&quot;</span><span class="p">),</span> <span class="n">lwd</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s2">&quot;Gdot Ref. LGU+&quot;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">&lt;-</span> <span class="n">envelope</span><span class="p">(</span><span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span><span class="p">,</span> <span class="n">fun</span> <span class="o">=</span> <span class="n">Gdot</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;LGU+&quot;</span><span class="p">,</span> <span class="n">nsim</span> <span class="o">=</span> <span class="mi">99</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">Kdot</span><span class="p">(</span><span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span><span class="p">,</span> <span class="s2">&quot;LGU+&quot;</span><span class="p">),</span> <span class="n">lwd</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s2">&quot;Kdot Ref. LGU+&quot;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">&lt;-</span> <span class="n">envelope</span><span class="p">(</span><span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span><span class="p">,</span> <span class="n">fun</span> <span class="o">=</span> <span class="n">Kdot</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;LGU+&quot;</span><span class="p">,</span> <span class="n">nsim</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">Ldot</span><span class="p">(</span><span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span><span class="p">,</span> <span class="s2">&quot;LGU+&quot;</span><span class="p">),</span> <span class="n">lwd</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s2">&quot;Ldot Ref. LGU+&quot;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">&lt;-</span> <span class="n">envelope</span><span class="p">(</span><span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span><span class="p">,</span> <span class="n">fun</span> <span class="o">=</span> <span class="n">Ldot</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;LGU+&quot;</span><span class="p">,</span> <span class="n">nsim</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
</pre></div>


<p><img alt="wifitypes" src="https://stathwang.github.io/images/wifitypes.png"></p>
<h3>Foursquare Data</h3>
<p>First, get your own client ID and client secret from the <a href="https://developer.foursquare.com">Foursquare API</a> page by signing up. Then, for every free public WiFi location coordinate - that is, for every pair of latitude and longitude of our data <code>wifi</code> from above, retrieve up to 50 different locations (latitude and longitude) within the radius of 400m and their business names, business categories, total number of checkins, users, and tips. Refer to my R code below.</p>
<div class="highlight"><pre><span></span><span class="n">client_id</span> <span class="o">&lt;-</span> <span class="s2">&quot;USE_YOUR_OWN_CLIENT_ID&quot;</span>
<span class="n">client_secret</span> <span class="o">&lt;-</span> <span class="s2">&quot;USE_YOUR_OWN_CLIENT_SECRET&quot;</span>

<span class="n">starttime</span> <span class="o">&lt;-</span> <span class="n">Sys</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">dat</span> <span class="o">&lt;-</span> <span class="n">llply</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">wifi</span><span class="p">),</span> <span class="n">function</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">lats</span> <span class="o">&lt;-</span> <span class="n">wifi</span><span class="err">$</span><span class="n">lat</span>
  <span class="n">lngs</span> <span class="o">&lt;-</span> <span class="n">wifi</span><span class="err">$</span><span class="n">lng</span>
  <span class="n">lat</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
  <span class="n">lng</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">lngs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
  <span class="n">ll</span> <span class="o">&lt;-</span> <span class="n">paste0</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">lng</span><span class="p">)</span>
  <span class="n">url</span> <span class="o">&lt;-</span> <span class="n">paste0</span><span class="p">(</span><span class="s2">&quot;https://api.foursquare.com/v2/venues/search?ll=&quot;</span><span class="p">,</span> <span class="n">ll</span><span class="p">,</span> <span class="s2">&quot;&amp;radius=&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span>
                <span class="s2">&quot;&amp;client_id=&quot;</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="s2">&quot;&amp;client_secret=&quot;</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span> 
                <span class="s2">&quot;&amp;limit=50&amp;intent=browse&amp;v=20160101&amp;m=foursquare&quot;</span><span class="p">)</span>
  <span class="n">output</span> <span class="o">&lt;-</span> <span class="n">getURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">vdata</span> <span class="o">&lt;-</span> <span class="n">fromJSON</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
  <span class="n">vv</span> <span class="o">&lt;-</span> <span class="n">vdata</span><span class="err">$</span><span class="n">response</span><span class="err">$</span><span class="n">venues</span>
  <span class="n">n</span> <span class="o">&lt;-</span> <span class="n">length</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">grp</span> <span class="o">&lt;-</span> <span class="n">llply</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">name</span>
      <span class="n">lat</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">location</span><span class="err">$</span><span class="n">lat</span>
      <span class="n">lng</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">location</span><span class="err">$</span><span class="n">lng</span>
      <span class="n">cat</span> <span class="o">&lt;-</span> <span class="n">ifelse</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">categories</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">categories</span><span class="p">[[</span><span class="mi">1</span><span class="p">]]</span><span class="err">$</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">stats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">checkins</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">users</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">tips</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">stats</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">chckins</span> <span class="o">=</span> <span class="n">users</span> <span class="o">=</span> <span class="n">tips</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="p">}</span>
      <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lng</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="n">checkins</span><span class="p">,</span> <span class="n">users</span><span class="p">,</span> <span class="n">tips</span><span class="p">)))</span>
    <span class="p">},</span> <span class="o">.</span><span class="n">parallel</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">rbindlist</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">cat</span><span class="p">(</span><span class="s1">&#39;Done with&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">wifi</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;%</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="p">},</span> <span class="o">.</span><span class="n">parallel</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">Sys</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">starttime</span><span class="p">)</span>

<span class="n">dt</span> <span class="o">&lt;-</span> <span class="n">rbindlist</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
<span class="n">fwrite</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="s2">&quot;fsq-locations.csv&quot;</span><span class="p">)</span>
</pre></div>


<h3>Point Process Models</h3>
<p>Fit a point process model (PPM) without marks</p>
<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">d7_q</span> <span class="o">&lt;-</span> <span class="n">d7</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">d7</span><span class="p">),</span> <span class="mi">12389</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)]</span>
<span class="n">p1</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">quadscheme</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span> <span class="o">~</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">quadscheme</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span> <span class="o">~</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">checkins</span> <span class="o">+</span> <span class="n">tips</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">quadscheme</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span> <span class="o">~</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">p4</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">quadscheme</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span> <span class="o">~</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">checkins</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p5</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">quadscheme</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span> <span class="o">~</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">users</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p6</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">quadscheme</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span> <span class="o">~</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">tips</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p7</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">quadscheme</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span> <span class="o">~</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">checkins</span> <span class="o">+</span> <span class="n">users</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p8</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">quadscheme</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span> <span class="o">~</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">checkins</span> <span class="o">+</span> <span class="n">tips</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p9</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">quadscheme</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span> <span class="o">~</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">users</span> <span class="o">+</span> <span class="n">tips</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p10</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">quadscheme</span><span class="p">(</span><span class="n">wfppp</span><span class="p">)</span> <span class="o">~</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">checkins</span> <span class="o">+</span> <span class="n">users</span> <span class="o">+</span> <span class="n">tips</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>

<span class="n">anova</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">p5</span><span class="p">,</span> <span class="n">p6</span><span class="p">,</span> <span class="n">p7</span><span class="p">,</span> <span class="n">p8</span><span class="p">,</span> <span class="n">p9</span><span class="p">,</span> <span class="n">p10</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="s2">&quot;LRT&quot;</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p4</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p5</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p6</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p7</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p8</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p9</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p10</span><span class="p">)</span>

<span class="n">diagnose</span><span class="o">.</span><span class="n">ppm</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="n">diagnose</span><span class="o">.</span><span class="n">ppm</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
<span class="n">diagnose</span><span class="o">.</span><span class="n">ppm</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>
</pre></div>


<p>Now fit a PPM with the mark.</p>
<div class="highlight"><pre><span></span><span class="n">Q</span>
<span class="n">d7_q</span> <span class="o">&lt;-</span> <span class="n">d7</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">d7</span><span class="p">),</span> <span class="mi">37167</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)]</span>
<span class="n">wfact</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">wifi</span><span class="err">$</span><span class="n">comp</span><span class="p">)</span>
<span class="n">wfact</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">wifi</span><span class="err">$</span><span class="n">cat</span><span class="p">)</span>
<span class="n">wfact</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">wifi</span><span class="p">[,</span><span class="n">c</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">)])</span>
<span class="n">wfact</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">wifi</span><span class="p">[,</span><span class="mi">6</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2385</span><span class="p">))</span>
<span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span> <span class="o">&lt;-</span> <span class="n">ppp</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">pts</span><span class="p">[,</span><span class="mi">1</span><span class="p">],</span> <span class="n">wifi</span><span class="o">.</span><span class="n">pts</span><span class="p">[,</span><span class="mi">2</span><span class="p">],</span> 
                 <span class="nb">xrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">poly</span><span class="p">[,</span><span class="mi">1</span><span class="p">]),</span>
                 <span class="n">yrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">poly</span><span class="p">[,</span><span class="mi">2</span><span class="p">]),</span>
                 <span class="n">marks</span> <span class="o">=</span> <span class="n">wfact</span><span class="p">)</span>

<span class="n">Q</span> <span class="o">&lt;-</span> <span class="n">quadscheme</span><span class="p">(</span><span class="n">wfdot</span><span class="o">.</span><span class="n">ppp</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">p3</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">marks</span><span class="p">)</span>
<span class="n">p4</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">marks</span> <span class="o">+</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">p5</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">marks</span> <span class="o">+</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">p6</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">marks</span> <span class="o">+</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">checkins</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p7</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">marks</span> <span class="o">+</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">users</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p8</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">marks</span> <span class="o">+</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">tips</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p9</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">marks</span> <span class="o">+</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">checkins</span> <span class="o">+</span> <span class="n">users</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p10</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">marks</span> <span class="o">+</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">checkins</span> <span class="o">+</span> <span class="n">tips</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p11</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">marks</span> <span class="o">+</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">users</span> <span class="o">+</span> <span class="n">tips</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="n">p12</span> <span class="o">&lt;-</span> <span class="n">ppm</span><span class="p">(</span><span class="n">Q</span> <span class="o">~</span> <span class="n">marks</span> <span class="o">+</span> <span class="n">polynom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">checkins</span> <span class="o">+</span> <span class="n">users</span> <span class="o">+</span> <span class="n">tips</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d7_q</span><span class="p">)</span>
<span class="c1"># p13 &lt;- ppm(Q ~ marks + polynom(x, y, 1) + checkins + users + tips + cat, data = d7_q)</span>

<span class="n">anova</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">p5</span><span class="p">,</span> <span class="n">p6</span><span class="p">,</span> <span class="n">p7</span><span class="p">,</span> <span class="n">p8</span><span class="p">,</span> <span class="n">p9</span><span class="p">,</span> <span class="n">p10</span><span class="p">,</span> <span class="n">p11</span><span class="p">,</span> <span class="n">p12</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="s2">&quot;LRT&quot;</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p4</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p5</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p6</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p7</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p8</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p9</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p10</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p11</span><span class="p">)</span>
<span class="n">AIC</span><span class="p">(</span><span class="n">p12</span><span class="p">)</span>

<span class="n">wt</span><span class="o">.</span><span class="n">pts</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">points</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">d7_q</span><span class="p">[,</span><span class="mi">3</span><span class="p">]),</span> <span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">d7_q</span><span class="p">[,</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">wt</span><span class="o">.</span><span class="n">pts</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">wt</span><span class="o">.</span><span class="n">pts</span><span class="p">)</span>
<span class="n">wfact</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">d7_q</span><span class="err">$</span><span class="n">checkins</span><span class="p">)</span>
<span class="n">wfact</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">d7_q</span><span class="err">$</span><span class="n">users</span><span class="p">)</span>
<span class="n">wfact</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">d7_q</span><span class="err">$</span><span class="n">tips</span><span class="p">)</span>
<span class="n">wt</span><span class="o">.</span><span class="n">ppp</span> <span class="o">&lt;-</span> <span class="n">ppp</span><span class="p">(</span><span class="n">wt</span><span class="o">.</span><span class="n">pts</span><span class="p">[,</span><span class="mi">1</span><span class="p">],</span> <span class="n">wt</span><span class="o">.</span><span class="n">pts</span><span class="p">[,</span><span class="mi">2</span><span class="p">],</span> 
              <span class="nb">xrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">poly</span><span class="p">[,</span><span class="mi">1</span><span class="p">]),</span>
              <span class="n">yrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">wifi</span><span class="o">.</span><span class="n">poly</span><span class="p">[,</span><span class="mi">2</span><span class="p">]),</span>
              <span class="n">marks</span> <span class="o">=</span> <span class="n">wfact</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">wt</span><span class="o">.</span><span class="n">ppp</span><span class="p">),</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">seoul_map</span> <span class="o">&lt;-</span> <span class="n">qmap</span><span class="p">(</span><span class="s1">&#39;seoul&#39;</span><span class="p">,</span> <span class="n">zoom</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> <span class="n">maptype</span> <span class="o">=</span> <span class="s1">&#39;roadmap&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="o">&lt;-</span> <span class="n">seoul_map</span> <span class="o">+</span> 
  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">wifi</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lng</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">comp</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">comp</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="n">q</span> <span class="o">&lt;-</span> <span class="n">seoul_map</span> <span class="o">+</span> 
  <span class="n">geom_polygon</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">wpt</span><span class="p">,</span>
               <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lng</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="o">..</span><span class="n">level</span><span class="o">..</span><span class="p">),</span>
               <span class="n">stat</span> <span class="o">=</span> <span class="s1">&#39;density2d&#39;</span><span class="p">,</span>
               <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">legend</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">),</span>
        <span class="n">legend</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
                                         <span class="n">size</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                                         <span class="n">linetype</span> <span class="o">=</span> <span class="s2">&quot;solid&quot;</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

<span class="c1">## INCLUDE THIS PLOT IN THE SLIDES</span>
<span class="n">p2</span> <span class="o">&lt;-</span> <span class="n">seoul_map</span> <span class="o">+</span> 
  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">wifi</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lng</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">comp</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">cat</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1">#facet_wrap(~comp) + </span>
  <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Wi-Fi Providers&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">border</span> <span class="o">=</span> <span class="n">element_rect</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">NA</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span>
        <span class="c1">#legend.position = &quot;none&quot;,</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

<span class="n">p3</span> <span class="o">&lt;-</span> <span class="n">seoul_map</span> <span class="o">+</span> 
  <span class="n">geom_polygon</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">wifi</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lng</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="o">..</span><span class="n">level</span><span class="o">..</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">comp</span><span class="p">),</span>
               <span class="n">stat</span> <span class="o">=</span> <span class="s1">&#39;density2d&#39;</span><span class="p">,</span>
               <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1">#facet_wrap(~cat) +</span>
  <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">comp</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Wi-Fi Providers&quot;</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">border</span> <span class="o">=</span> <span class="n">element_rect</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">NA</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">legend</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>

<span class="n">q2</span> <span class="o">&lt;-</span> <span class="n">seoul_map</span> <span class="o">+</span> 
  <span class="n">geom_polygon</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">wifi</span><span class="p">,</span>
               <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lng</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="o">..</span><span class="n">level</span><span class="o">..</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">comp</span><span class="p">),</span>
               <span class="n">stat</span> <span class="o">=</span> <span class="s1">&#39;density2d&#39;</span><span class="p">,</span>
               <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">cat</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>

<span class="n">q3</span> <span class="o">&lt;-</span> <span class="n">seoul_map</span> <span class="o">+</span>
  <span class="n">geom_polygon</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">wifi</span><span class="p">,</span> 
               <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lng</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="o">..</span><span class="n">level</span><span class="o">..</span><span class="p">),</span>
               <span class="n">stat</span> <span class="o">=</span> <span class="s1">&#39;density2d&#39;</span><span class="p">,</span>
               <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1">#scale_fill_gradient(low = &#39;#C6DBEF&#39;,</span>
  <span class="c1">#                    high = &#39;#08306B&#39;) +</span>
  <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">comp</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span>
</pre></div>


<p><img alt="diagnostics1" src="https://stathwang.github.io/images/diagnostics1.png">
<img alt="diagnostics2" src="https://stathwang.github.io/images/diagnostics2.png"></p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://stathwang.github.io/tag/point-process-models.html">point process models</a>
      <a href="https://stathwang.github.io/tag/spatial-statistics.html">spatial statistics</a>
      <a href="https://stathwang.github.io/tag/r.html">r</a>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'thedatalogical';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <hr />
    <p />
    <!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
  #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//github.us1.list-manage.com/subscribe/post?u=0f2c943c221c777ef88591fb6&amp;id=6cf4236c90" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
  <label for="mce-EMAIL">Subscribe to my sporadic data science newsletter and blog post</label>
  <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_0f2c943c221c777ef88591fb6_6cf4236c90" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<br />
<br />

<!--End mc_embed_signup-->

    <footer>
<p>
  &copy; Seong Hyun Hwang 2015 - 2017 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69797568-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
  <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us1.list-manage.com","uuid":"0f2c943c221c777ef88591fb6","lid":"6cf4236c90"}) })</script>



<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//" + stathwang.piwikpro.com + "/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//bnjbvr.alwaysdata.net/piwik/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Seong Hyun Hwang ",
  "url" : "https://stathwang.github.io",
  "image": "http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg",
  "description": "Seong Hyun Hwang's Thoughts and Writings"
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Predicting Free Public WiFi Locations in Seoul with Point Process Models using Foursquare API",
  "headline": "Predicting Free Public WiFi Locations in Seoul with Point Process Models using Foursquare API",
  "datePublished": "2017-06-25 01:45:00-04:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Seong Hyun Hwang",
    "url": "https://stathwang.github.io/author/seong-hyun-hwang.html"
  },
  "image": "http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg",
  "url": "https://stathwang.github.io/predicting-free-public-wifi-locations-in-seoul-with-point-process-models-using-foursquare-api.html",
  "description": "Spatial Statistics The field of spatial statistics is experiencing a period of rapid growth, though less so compared to that of machine learning and artificial intelligence, with the onset of location technology and efficient solution techniques for high performance computing that augments many classical frequentist inference procedures developed years ago …"
}
</script></body>
</html>