<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://stathwang.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://stathwang.github.io/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://stathwang.github.io/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://stathwang.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Seong Hyun Hwang Atom">



  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="author" content="Seong Hyun Hwang" />
<meta name="description" content="Recently I've discovered a dataset online that is a collection of 20M web queries from about 650K users over three months from March 1 to May 31 2006. The columns are listed as follows: User ID - an anonymous user ID number Query - the query submitted by the user Query Time …" />
<meta name="keywords" content="community detection, network, graph, machine learning, python">
<meta property="og:site_name" content="Seong Hyun Hwang"/>
<meta property="og:title" content="Multilevel URL Community Detection with Infomap"/>
<meta property="og:description" content="Recently I've discovered a dataset online that is a collection of 20M web queries from about 650K users over three months from March 1 to May 31 2006. The columns are listed as follows: User ID - an anonymous user ID number Query - the query submitted by the user Query Time …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://stathwang.github.io/multilevel-url-community-detection-with-infomap.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-03-12 19:13:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://stathwang.github.io/author/seong-hyun-hwang.html">
<meta property="article:section" content="Machine Learning"/>
<meta property="article:tag" content="community detection"/>
<meta property="article:tag" content="network"/>
<meta property="article:tag" content="graph"/>
<meta property="article:tag" content="machine learning"/>
<meta property="article:tag" content="python"/>
<meta property="og:image" content="http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg">
  <title>Seong Hyun Hwang &ndash; Multilevel URL Community Detection with Infomap</title>
</head>
<body>
  <aside>
    <div>
      <a href="https://stathwang.github.io">
        <img src="http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg" alt="Seong Hyun Hwang" title="Seong Hyun Hwang">
      </a>
      <h1><a href="https://stathwang.github.io">Seong Hyun Hwang</a></h1>
<p>Data Scientist - Product Developer</p>      <nav>
        <ul class="list">
          <li><a href="https://stathwang.github.io/pages/about.html#about">about</a></li>
          <li><a href="https://stathwang.github.io/pages/projects.html#projects">projects</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-github" href="https://github.com/stathwang" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/superhugehwang" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-rss" href="//stathwang.github.io/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="https://stathwang.github.io">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
      <a href="https://stathwang.github.io/feeds/all.atom.xml">Atom</a>
    </nav>

<article>
  <header>
    <h1 id="multilevel-url-community-detection-with-infomap">Multilevel URL Community Detection with Infomap</h1>
    <p>Posted on Sun 12 March 2017 in <a href="https://stathwang.github.io/category/machine-learning.html">Machine Learning</a></p>
  </header>
  <div>
    <p>Recently I've discovered a dataset online that is a collection of 20M web queries from about 650K users over three months from March 1 to May 31 2006.</p>
<p>The columns are listed as follows:</p>
<ul>
<li>User ID - an anonymous user ID number</li>
<li>Query - the query submitted by the user</li>
<li>Query Time - the time at which the query was submitted for search</li>
<li>Item Rank - if the user clicked on a search result, the rank of the item on which they clicked is listed</li>
<li>Click URL - if the user clicked on a search result, the domain portion of the URL in the clicked result is listed</li>
</ul>
<p>A more detailed description of the dataset can be found <a href="http://sing.stanford.edu/cs303-sp10/assignments/U500k_README.txt">here</a>.</p>
<p>My goal is to find clusters of queries or url domains that are semantically and syntactically similar based on queries submitted or urls visited by a set of users. For example, a query <code>find baby food</code> is correlated with <code>healthy baby food</code> or <code>Gerber Good Start</code>, a brand name for baby food. Likewise, domains <code>healthplans.com</code> and <code>ehealthinsurance.com</code> can be grouped under the health insurance category. I've decided to cluster url domains, but you can always try with queries instead and compare which of the two results gives the better cluster representation.</p>
<p>The dataset is somewhat large, so I took careful steps to sample about 1000 users and 7500 domains after removing rows with generic, non-informative queries such as <code>google</code> and <code>yahoo</code> along with domains like <code>google.com</code> or <code>-</code> and after defining an active user to be a user with more than 10 rows. Only <code>usr</code> and <code>click_url</code> columns are used to cluster url domains. Below is the R script that preprocesses the dataset.</p>
<div class="highlight"><pre><span></span><span class="n">library</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>

<span class="c1"># http://sing.stanford.edu/cs303-sp10/assignments</span>
<span class="n">f</span> <span class="o">&lt;-</span> <span class="n">fread</span><span class="p">(</span><span class="s2">&quot;user-ct-test-collection-01.txt&quot;</span><span class="p">)</span>
<span class="n">setnames</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;usr&#39;</span><span class="p">,</span> <span class="s1">&#39;qry&#39;</span><span class="p">,</span> <span class="s1">&#39;qry_time&#39;</span><span class="p">,</span> <span class="s1">&#39;item_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;click_url&#39;</span><span class="p">))</span>

<span class="n">qdat</span> <span class="o">&lt;-</span> <span class="n">f</span><span class="p">[,</span> <span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">qry</span><span class="p">][</span><span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">)]</span>
<span class="n">rdat</span> <span class="o">&lt;-</span> <span class="n">f</span><span class="p">[,</span> <span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">click_url</span><span class="p">][</span><span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">)]</span>
<span class="n">f</span> <span class="o">&lt;-</span> <span class="n">f</span><span class="p">[</span><span class="err">!</span><span class="n">click_url</span> <span class="o">%</span><span class="ow">in</span><span class="o">%</span> <span class="n">rdat</span><span class="err">$</span><span class="n">click_url</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">100</span><span class="p">]][</span><span class="err">!</span><span class="n">qry</span> <span class="o">%</span><span class="ow">in</span><span class="o">%</span> <span class="n">qdat</span><span class="err">$</span><span class="n">qry</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">50</span><span class="p">]]</span>
<span class="n">udat</span> <span class="o">&lt;-</span> <span class="n">f</span><span class="p">[,</span> <span class="o">.</span><span class="p">(</span><span class="n">rows</span> <span class="o">=</span> <span class="o">.</span><span class="n">N</span><span class="p">,</span> 
              <span class="n">qrys</span> <span class="o">=</span> <span class="n">uniqueN</span><span class="p">(</span><span class="n">qry</span><span class="p">),</span>
              <span class="n">urls</span> <span class="o">=</span> <span class="n">uniqueN</span><span class="p">(</span><span class="n">click_url</span><span class="p">)),</span> <span class="n">usr</span><span class="p">][</span><span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="n">rows</span><span class="p">)]</span>
<span class="n">udat</span> <span class="o">&lt;-</span> <span class="n">udat</span><span class="p">[</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">]</span>

<span class="nb">set</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">23456</span><span class="p">)</span>
<span class="n">udat</span> <span class="o">&lt;-</span> <span class="n">udat</span><span class="p">[</span><span class="n">usr</span> <span class="o">%</span><span class="ow">in</span><span class="o">%</span> <span class="n">sample</span><span class="p">(</span><span class="n">usr</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>

<span class="nb">set</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">65432</span><span class="p">)</span>
<span class="n">fsub2</span> <span class="o">&lt;-</span> <span class="n">f</span><span class="p">[</span><span class="n">usr</span> <span class="o">%</span><span class="ow">in</span><span class="o">%</span> <span class="n">udat</span><span class="err">$</span><span class="n">usr</span><span class="p">][</span><span class="n">click_url</span> <span class="o">%</span><span class="ow">in</span><span class="o">%</span> <span class="n">sample</span><span class="p">(</span><span class="n">click_url</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)]</span>
<span class="n">fr</span> <span class="o">&lt;-</span> <span class="n">unique</span><span class="p">(</span><span class="n">fsub2</span><span class="p">[,</span> <span class="o">.</span><span class="p">(</span><span class="n">usr</span><span class="p">,</span> <span class="n">click_url</span><span class="p">)])</span>
<span class="n">uniqueN</span><span class="p">(</span><span class="n">fr</span><span class="err">$</span><span class="n">usr</span><span class="p">);</span> <span class="n">uniqueN</span><span class="p">(</span><span class="n">fr</span><span class="err">$</span><span class="n">click_url</span><span class="p">)</span> <span class="c1"># 998 users, 7735 urls</span>

<span class="n">fwrite</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="s2">&quot;session-url-data.csv&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
</pre></div>


<p>Once I've sampled a set of users, I create an <span class="math">\(N\)</span> by <span class="math">\(N\)</span> matrix of url domain similarity where <span class="math">\(N\)</span> is the total number of urls and each element of the matrix is the <a href="https://en.wikipedia.org/wiki/Jaccard_index">Jaccard index</a> between a set of users to the first domain and to the second domain. For example, let's assume that a set of users numbered 1, 2, and 3 visited the webpage <code>healthplans.com</code> and a set of users 1, 3, 4, and 5 visited <code>ehealthinsurance.com</code>. The Jaccard similarity index of the two domains is <span class="math">\(2/5\)</span> since there are two overlapping users (1 and 2) out of 5 total users (1, 2, 3, 4 and 5). </p>
<p>Below is the Python code where the <code>main()</code> function computes a url domain similarity matrix, while the <code>metric()</code> function gives different measures of similarity between domains and the <code>write_pajek_list()</code> function writes the resulting matrix into a <code>.net</code> format. Note that I write urls when in fact I mean domains. Only the elements whose Jaccard indices are greater than 0.85 get written to the output file.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">usr_url_pairs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">url_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;session-url-data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">usr_url_pairs</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">urls</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">users</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">url_dict</span><span class="p">:</span>
                <span class="n">url_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">url_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Convert a set into a list gives a deduped ordered list of the urls</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>
    <span class="n">url_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>
    <span class="n">user_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;Number of URL Domains: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">url_count</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;Number of Users: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_count</span><span class="p">)</span>

    <span class="n">distance_matrix</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">link_list</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

    <span class="c1"># Construct a matrix of url-url similarity</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="n">distance_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">url_count</span><span class="p">))</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">)</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;URL domains computed: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">urls</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">similarity</span> <span class="o">=</span> <span class="n">metric</span><span class="p">(</span><span class="n">url_dict</span><span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">url_dict</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;jaccard&#39;</span><span class="p">,</span> <span class="n">total_users</span> <span class="o">=</span> <span class="n">user_count</span><span class="p">)</span>
            <span class="n">distance_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">similarity</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">link_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">distance_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">write_pajek_list</span><span class="p">(</span><span class="n">link_list</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">url_count</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">write_pajek_list</span><span class="p">(</span><span class="n">link_list</span><span class="p">,</span> <span class="n">url_list</span><span class="p">,</span> <span class="n">url_count</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;link_list.net&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;*Vertices &#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">url_count</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">url_list</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &quot;&#39;</span> <span class="o">+</span> <span class="n">row</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;*Edges &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">link_list</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">link_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">85</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">metric</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;jaccard&#39;</span><span class="p">,</span> <span class="n">total_users</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;jaccard&#39;</span><span class="p">:</span>
        <span class="n">J</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="n">w</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span> <span class="o">|</span> <span class="n">w</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">J</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;normalized&#39;</span><span class="p">:</span>
        <span class="n">J</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="n">w</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">total_users</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">J</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;distance&#39;</span><span class="p">:</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">v</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">J</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>It's reasonable to convert a url domain similarity matrix into a graphical network where a node is a domain and an edge between two nodes is a degree of similarity between two domains. I've decided to use the state-of-the-art multilevel community detection with the map equation framework and its accompanying search algorithm Infomap. <a href="http://www.mapequation.org/assets/publications/mapequationtutorial.pdf">This</a> paper provides a detailed explanation and tutorial of the method. Basically, the algorithm partitions a large network by detecting different communities where a set of nodes form a community when more edges are seen among nodes within the community than between other nodes not in the community. A community detection problem is inherently different from a clustering analysis since the latter Unlike <a href="http://stackoverflow.com/questions/9471906/what-are-the-differences-between-community-detection-algorithms-in-igraph">other</a> community detection algorithms out there, the Infomap algorithm finds communities of hierarchical structure where smaller nested communities are semantically more specific than .</p>
<p>Once you download the source code from its main <a href="http://www.mapequation.org/code.html">site</a>, run the following in the folder. You can tune the algorithm by adding other parameters.</p>
<div class="highlight"><pre><span></span><span class="o">./</span><span class="n">Infomap</span> <span class="n">link_list</span><span class="o">.</span><span class="n">net</span> <span class="n">output</span><span class="o">/</span> <span class="o">-</span><span class="n">N</span> <span class="mi">10</span> <span class="o">--</span><span class="n">tree</span> <span class="o">--</span><span class="n">bftree</span>
</pre></div>


<p>The outputs are <code>link_list.tree</code> and <code>link_list.bftree</code>.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://stathwang.github.io/tag/community-detection.html">community detection</a>
      <a href="https://stathwang.github.io/tag/network.html">network</a>
      <a href="https://stathwang.github.io/tag/graph.html">graph</a>
      <a href="https://stathwang.github.io/tag/machine-learning.html">machine learning</a>
      <a href="https://stathwang.github.io/tag/python.html">python</a>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'thedatalogical';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <hr />
    <p />
    <!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
  #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//github.us1.list-manage.com/subscribe/post?u=0f2c943c221c777ef88591fb6&amp;id=6cf4236c90" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
  <label for="mce-EMAIL">Subscribe to my sporadic data science newsletter and blog post</label>
  <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_0f2c943c221c777ef88591fb6_6cf4236c90" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<br />
<br />

<!--End mc_embed_signup-->

    <footer>
        <p>&copy; Seong Hyun Hwang 2017</p>
    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69797568-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
  <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us1.list-manage.com","uuid":"0f2c943c221c777ef88591fb6","lid":"6cf4236c90"}) })</script>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Seong Hyun Hwang ",
  "url" : "https://stathwang.github.io",
  "image": "http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg",
  "description": "Seong Hyun Hwang's Thoughts and Writings"
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Multilevel URL Community Detection with Infomap",
  "headline": "Multilevel URL Community Detection with Infomap",
  "datePublished": "2017-03-12 19:13:00-04:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Seong Hyun Hwang",
    "url": "https://stathwang.github.io/author/seong-hyun-hwang.html"
  },
  "image": "http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg",
  "url": "https://stathwang.github.io/multilevel-url-community-detection-with-infomap.html",
  "description": "Recently I've discovered a dataset online that is a collection of 20M web queries from about 650K users over three months from March 1 to May 31 2006. The columns are listed as follows: User ID - an anonymous user ID number Query - the query submitted by the user Query Time …"
}
</script></body>
</html>