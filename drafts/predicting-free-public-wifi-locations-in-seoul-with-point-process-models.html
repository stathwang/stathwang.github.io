<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://stathwang.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://stathwang.github.io/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://stathwang.github.io/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://stathwang.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Seong Hyun Hwang Atom">



  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="author" content="Seong Hyun Hwang" />
<meta name="description" content="The field of spatial statistics is still quite new although many frequentist methods have been developed many years ago. In this post, I'm going to model free public WiFi locations in Seoul, Korea and predict Load the dataset of free public WiFi locations in Seoul, Korea. The dataset consists of …" />
<meta name="keywords" content="point process models, spatial statistics, r">
<meta property="og:site_name" content="Seong Hyun Hwang"/>
<meta property="og:title" content="Predicting Free Public WiFi Locations in Seoul with Point Process Models"/>
<meta property="og:description" content="The field of spatial statistics is still quite new although many frequentist methods have been developed many years ago. In this post, I'm going to model free public WiFi locations in Seoul, Korea and predict Load the dataset of free public WiFi locations in Seoul, Korea. The dataset consists of …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://stathwang.github.io/drafts/predicting-free-public-wifi-locations-in-seoul-with-point-process-models.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-06-24 23:45:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://stathwang.github.io/author/seong-hyun-hwang.html">
<meta property="article:section" content="Statistics"/>
<meta property="article:tag" content="point process models"/>
<meta property="article:tag" content="spatial statistics"/>
<meta property="article:tag" content="r"/>
<meta property="og:image" content="http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg">
  <title>Seong Hyun Hwang &ndash; Predicting Free Public WiFi Locations in Seoul with Point Process Models</title>
</head>
<body>
  <aside>
    <div>
      <a href="https://stathwang.github.io">
        <img src="http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg" alt="Seong Hyun Hwang" title="Seong Hyun Hwang">
      </a>
      <h1><a href="https://stathwang.github.io">Seong Hyun Hwang</a></h1>
<p>Data Scientist - Product Developer</p>      <nav>
        <ul class="list">
          <li><a href="https://stathwang.github.io/pages/about.html#about">about</a></li>
          <li><a href="https://stathwang.github.io/pages/photos.html#photos">photos</a></li>
          <li><a href="https://stathwang.github.io/pages/projects.html#projects">projects</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-github" href="https://github.com/stathwang" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-google" href="https://plus.google.com/112356517445062778569" target="_blank"><i class="fa fa-google"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/superhugehwang" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-rss" href="//stathwang.github.io/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="https://stathwang.github.io">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
      <a href="https://stathwang.github.io/feeds/all.atom.xml">Atom</a>
    </nav>

<article>
  <header>
    <h1 id="predicting-free-public-wifi-locations-in-seoul-with-point-process-models">Predicting Free Public WiFi Locations in Seoul with Point Process Models</h1>
    <p>Posted on June 24 2017 in <a href="https://stathwang.github.io/category/statistics.html">Statistics</a></p>
  </header>
  <div>
    <p>The field of spatial statistics is still quite new although many frequentist methods have been developed many years ago. In this post, I'm going to model free public WiFi locations in Seoul, Korea and predict </p>
<p>Load the dataset of free public WiFi locations in Seoul, Korea. The dataset consists of spatial coordinates (longitude and latitude), categories of WiFi network providers, and location categories.</p>
<p>Load the libraries, read <code>seoul-wifi-public.json</code> file into a <code>data.table</code> object in R, and save it to <code>seoul-public-wifi.csv</code> file.</p>
<div class="highlight"><pre><span></span><span class="n">library</span><span class="p">(</span><span class="n">RCurl</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">jsonlite</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">spdep</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">splancs</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">spatstat</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">animation</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span>

<span class="n">vt</span> <span class="o">&lt;-</span> <span class="n">fromJSON</span><span class="p">(</span><span class="s2">&quot;seoul-wifi-public.json&quot;</span><span class="p">,</span> <span class="n">simplifyDataFrame</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">vdat</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">vt</span><span class="err">$</span><span class="n">DATA</span><span class="p">)</span>
<span class="n">setnames</span><span class="p">(</span><span class="n">vdat</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;lng&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;gu_unit&quot;</span><span class="p">,</span> <span class="s2">&quot;comp&quot;</span><span class="p">))</span>
<span class="n">fwrite</span><span class="p">(</span><span class="n">vdat</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="s2">&quot;seoul-public-wifi.csv&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
</pre></div>


<p>First, get your own client ID and client secret from the <a href="https://developer.foursquare.com">Foursquare API</a> page by signing up. Then, for every free public WiFi location coordinate - that is, for every pair of latitude and longitude of our data <code>vdat</code> from above, retrieve up to 50 different locations (latitude and longitude) within the radius of 400m and their business names, business categories, total number of checkins, users, and tips. Refer to my R code below.</p>
<div class="highlight"><pre><span></span><span class="n">client_id</span> <span class="o">&lt;-</span> <span class="s2">&quot;USE_YOUR_OWN_CLIENT_ID&quot;</span>
<span class="n">client_secret</span> <span class="o">&lt;-</span> <span class="s2">&quot;USE_YOUR_OWN_CLIENT_SECRET&quot;</span>

<span class="n">starttime</span> <span class="o">&lt;-</span> <span class="n">Sys</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">dat</span> <span class="o">&lt;-</span> <span class="n">llply</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">vdat</span><span class="p">),</span> <span class="n">function</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">lats</span> <span class="o">&lt;-</span> <span class="n">vdat</span><span class="err">$</span><span class="n">lat</span>
  <span class="n">lngs</span> <span class="o">&lt;-</span> <span class="n">vdat</span><span class="err">$</span><span class="n">lng</span>
  <span class="n">lat</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
  <span class="n">lng</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">lngs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
  <span class="n">ll</span> <span class="o">&lt;-</span> <span class="n">paste0</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">lng</span><span class="p">)</span>
  <span class="n">url</span> <span class="o">&lt;-</span> <span class="n">paste0</span><span class="p">(</span><span class="s2">&quot;https://api.foursquare.com/v2/venues/search?ll=&quot;</span><span class="p">,</span> <span class="n">ll</span><span class="p">,</span> <span class="s2">&quot;&amp;radius=&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span>
                <span class="s2">&quot;&amp;client_id=&quot;</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="s2">&quot;&amp;client_secret=&quot;</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span> 
                <span class="s2">&quot;&amp;limit=50&amp;intent=browse&amp;v=20160101&amp;m=foursquare&quot;</span><span class="p">)</span>
  <span class="n">output</span> <span class="o">&lt;-</span> <span class="n">getURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">vdata</span> <span class="o">&lt;-</span> <span class="n">fromJSON</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
  <span class="n">vv</span> <span class="o">&lt;-</span> <span class="n">vdata</span><span class="err">$</span><span class="n">response</span><span class="err">$</span><span class="n">venues</span>
  <span class="n">n</span> <span class="o">&lt;-</span> <span class="n">length</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">grp</span> <span class="o">&lt;-</span> <span class="n">llply</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">name</span>
      <span class="n">lat</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">location</span><span class="err">$</span><span class="n">lat</span>
      <span class="n">lng</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">location</span><span class="err">$</span><span class="n">lng</span>
      <span class="n">cat</span> <span class="o">&lt;-</span> <span class="n">ifelse</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">categories</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">categories</span><span class="p">[[</span><span class="mi">1</span><span class="p">]]</span><span class="err">$</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">stats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">checkins</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">users</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">tips</span> <span class="o">&lt;-</span> <span class="n">vv</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="err">$</span><span class="n">stats</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">chckins</span> <span class="o">=</span> <span class="n">users</span> <span class="o">=</span> <span class="n">tips</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="p">}</span>
      <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lng</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="n">checkins</span><span class="p">,</span> <span class="n">users</span><span class="p">,</span> <span class="n">tips</span><span class="p">)))</span>
    <span class="p">},</span> <span class="o">.</span><span class="n">parallel</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">rbindlist</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">cat</span><span class="p">(</span><span class="s1">&#39;Done with&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">vdat</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;%</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="p">},</span> <span class="o">.</span><span class="n">parallel</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">Sys</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">starttime</span><span class="p">)</span>

<span class="n">dt</span> <span class="o">&lt;-</span> <span class="n">rbindlist</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
<span class="n">fwrite</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="s2">&quot;fsq-locations.csv&quot;</span><span class="p">)</span>
</pre></div>


<p>Spatially join the output with the Seoul municipalities shapefile.</p>
<div class="highlight"><pre><span></span>shape <span class="o">&lt;-</span> readOGR<span class="p">(</span><span class="s">&quot;/Users/seonghwang/Downloads/seoul_municipalities.shp&quot;</span><span class="p">)</span>
plot<span class="p">(</span>shape<span class="p">)</span>

wifi <span class="o">&lt;-</span> fread<span class="p">(</span><span class="s">&quot;/Users/seonghwang/Desktop/Spatial-Foursquare/seoul-public-wifi-data.csv&quot;</span><span class="p">)</span>
wifi<span class="o">$</span>lng <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span>wifi<span class="o">$</span>lng<span class="p">)</span>
wifi<span class="o">$</span>lat <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span>wifi<span class="o">$</span>lat<span class="p">)</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;공공기관&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Public Institutions&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;공원&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Parks&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;문화시설&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Cultural Facilities&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;버스승차대&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Bus Stops&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;보건시설&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Health Facilities&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;복지시설&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Welfare Facilities&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;전통시장&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Traditional Markets&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;주민센터&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Community Centers&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;주요거리&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Main Streets&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;산책로&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Walking Trails&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;광장&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Plazas&quot;</span>
wifi<span class="o">$</span><span class="kp">cat</span><span class="p">[</span>wifi<span class="o">$</span>cat <span class="o">==</span> <span class="s">&quot;관광&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&quot;Tourist Destinations&quot;</span>

wifi<span class="o">$</span>comp <span class="o">&lt;-</span> <span class="kp">as.factor</span><span class="p">(</span>wifi<span class="o">$</span>comp<span class="p">)</span>
wifi<span class="o">$</span>cat <span class="o">&lt;-</span> <span class="kp">as.factor</span><span class="p">(</span>wifi<span class="o">$</span><span class="kp">cat</span><span class="p">)</span>
wifi <span class="o">&lt;-</span> wifi<span class="p">[</span>comp <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;SKT&quot;</span><span class="p">,</span> <span class="s">&quot;KT&quot;</span><span class="p">,</span> <span class="s">&quot;LGU+&quot;</span><span class="p">)]</span>
wifi <span class="o">&lt;-</span> wifi<span class="p">[</span><span class="m">-1065</span><span class="p">,]</span>
wifi <span class="o">&lt;-</span> wifi<span class="p">[</span><span class="m">-489</span><span class="p">,]</span>
wifi <span class="o">&lt;-</span> wifi<span class="p">[</span><span class="m">-452</span><span class="p">,]</span>
wifi <span class="o">&lt;-</span> wifi<span class="p">[</span><span class="o">-</span><span class="kt">c</span><span class="p">(</span><span class="m">518</span><span class="o">:</span><span class="m">531</span><span class="p">),]</span>
wifi <span class="o">&lt;-</span> wifi<span class="p">[</span><span class="o">-</span><span class="kt">c</span><span class="p">(</span><span class="m">517</span><span class="o">:</span><span class="m">519</span><span class="p">),]</span>

kt.list <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">()</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>shape<span class="o">@</span>polygons<span class="p">))</span> <span class="p">{</span>
  kt <span class="o">&lt;-</span> shape<span class="o">@</span>polygons<span class="p">[[</span>i<span class="p">]]</span><span class="o">@</span>Polygons<span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">@</span>coords
  kt.list<span class="p">[[</span>i<span class="p">]]</span> <span class="o">&lt;-</span> kt
<span class="p">}</span>

kt.list <span class="o">&lt;-</span> <span class="kp">do.call</span><span class="p">(</span><span class="kp">rbind</span><span class="p">,</span> kt.list<span class="p">)</span>

wifi.pts <span class="o">&lt;-</span> as.points<span class="p">(</span>wifi<span class="o">$</span>lng<span class="p">,</span> wifi<span class="o">$</span>lat<span class="p">)</span>
wifi.poly <span class="o">&lt;-</span> as.points<span class="p">(</span>kt.list<span class="p">[,</span><span class="m">1</span><span class="p">],</span> kt.list<span class="p">[,</span><span class="m">2</span><span class="p">])</span>
wfppp <span class="o">&lt;-</span> ppp<span class="p">(</span>wifi.pts<span class="p">[,</span><span class="m">1</span><span class="p">],</span> wifi.pts<span class="p">[,</span><span class="m">2</span><span class="p">],</span>
             xrange <span class="o">=</span> <span class="kp">range</span><span class="p">(</span>wifi.poly<span class="p">[,</span><span class="m">1</span><span class="p">]),</span>
             yrange <span class="o">=</span> <span class="kp">range</span><span class="p">(</span>wifi.poly<span class="p">[,</span><span class="m">2</span><span class="p">]))</span>

par<span class="p">(</span>mfrow <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
plot<span class="p">(</span>wifi.pts<span class="p">[,</span><span class="m">1</span><span class="p">],</span> wifi.pts<span class="p">[,</span><span class="m">2</span><span class="p">],</span> pch <span class="o">=</span> <span class="m">20</span><span class="p">,</span> cex <span class="o">=</span> <span class="m">1.2</span><span class="p">)</span>
polymap<span class="p">(</span>wifi.poly<span class="p">,</span> add <span class="o">=</span> <span class="bp">T</span><span class="p">)</span>

<span class="c1"># K, L, G, F, J functions</span>
wf.env <span class="o">&lt;-</span> envelope<span class="p">(</span>wfppp<span class="p">,</span> fun <span class="o">=</span> Kest<span class="p">)</span>
wf.K <span class="o">&lt;-</span> Kest<span class="p">(</span>wfppp<span class="p">)</span>
Kplot<span class="p">(</span>wf.env<span class="p">,</span> wf.K<span class="p">,</span> datatitle <span class="o">=</span> <span class="s">&quot;Wi-Fi Locations&quot;</span><span class="p">)</span>
L<span class="p">(</span>wf.env<span class="p">,</span> wf.K<span class="p">,</span> datatitle <span class="o">=</span> <span class="s">&quot;Wi-Fi Locations&quot;</span><span class="p">)</span>

wf.env <span class="o">&lt;-</span> envelope<span class="p">(</span>wfppp<span class="p">,</span> fun <span class="o">=</span> Gest<span class="p">)</span>
wf.G <span class="o">&lt;-</span> Gest<span class="p">(</span>wfppp<span class="p">)</span>
G<span class="p">(</span>wf.env<span class="p">,</span> wf.G<span class="p">,</span> <span class="s">&quot;G&quot;</span><span class="p">)</span>

wf.env <span class="o">&lt;-</span> envelope<span class="p">(</span>wfppp<span class="p">,</span> fun <span class="o">=</span> Fest<span class="p">)</span>
wf.F <span class="o">&lt;-</span> Fest<span class="p">(</span>wfppp<span class="p">)</span>
Ffunc<span class="p">(</span>wf.env<span class="p">,</span> wf.F<span class="p">,</span> <span class="s">&quot;F&quot;</span><span class="p">)</span>

wf.env <span class="o">&lt;-</span> envelope<span class="p">(</span>wfppp<span class="p">,</span> fun <span class="o">=</span> Jest<span class="p">)</span>
wf.J <span class="o">&lt;-</span> Jest<span class="p">(</span>wfppp<span class="p">)</span>
Jfunc<span class="p">(</span>wf.env<span class="p">,</span> wf.J<span class="p">,</span> xlims <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.03</span><span class="p">),</span> ylims <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> datatitle <span class="o">=</span> <span class="s">&quot;J&quot;</span><span class="p">)</span>

<span class="c1"># Marked point process</span>
wfact <span class="o">&lt;-</span> <span class="kp">as.factor</span><span class="p">(</span>wifi<span class="o">$</span>comp<span class="p">)</span>
wfact <span class="o">&lt;-</span> <span class="kp">as.factor</span><span class="p">(</span>wifi<span class="o">$</span><span class="kp">cat</span><span class="p">)</span>
wfact <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>wifi<span class="p">[,</span><span class="kt">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">2</span><span class="p">)])</span>
wfdot.ppp <span class="o">&lt;-</span> ppp<span class="p">(</span>wifi.pts<span class="p">[,</span><span class="m">1</span><span class="p">],</span> wifi.pts<span class="p">[,</span><span class="m">2</span><span class="p">],</span> 
                 xrange <span class="o">=</span> <span class="kp">range</span><span class="p">(</span>wifi.poly<span class="p">[,</span><span class="m">1</span><span class="p">]),</span>
                 yrange <span class="o">=</span> <span class="kp">range</span><span class="p">(</span>wifi.poly<span class="p">[,</span><span class="m">2</span><span class="p">]),</span>
                 marks <span class="o">=</span> wfact<span class="p">)</span>
plot<span class="p">(</span><span class="kp">split</span><span class="p">(</span>wfdot.ppp<span class="p">,</span> f <span class="o">=</span> <span class="s">&quot;comp&quot;</span><span class="p">),</span> chars <span class="o">=</span> <span class="m">16</span><span class="p">)</span>
plot<span class="p">(</span><span class="kp">split</span><span class="p">(</span>wfdot.ppp<span class="p">),</span> chars <span class="o">=</span> <span class="m">16</span><span class="p">)</span>
plot<span class="p">(</span>density<span class="p">(</span><span class="kp">split</span><span class="p">(</span>wfdot.ppp<span class="p">)),</span> chars <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">16</span><span class="o">:</span><span class="m">18</span><span class="p">),</span> ribbon <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>

<span class="c1"># Relative risk</span>
mainerr <span class="o">=</span> relrisk<span class="p">(</span>wfdot.ppp<span class="p">)</span>
plot<span class="p">(</span>mainerr<span class="p">,</span> main <span class="o">=</span> <span class="s">&quot;Relative Risk by WiFi Provider&quot;</span><span class="p">)</span>
plot<span class="p">(</span>im.apply<span class="p">(</span>mainerr<span class="p">,</span> <span class="kp">which.max</span><span class="p">),</span> main <span class="o">=</span> <span class="s">&quot;Most Common WiFi Providers&quot;</span><span class="p">)</span>

<span class="c1"># Gdot, Kdot, Ldot from one to many</span>
plot<span class="p">(</span>Gdot<span class="p">(</span>wfdot.ppp<span class="p">,</span> <span class="s">&quot;LGU+&quot;</span><span class="p">),</span> lwd <span class="o">=</span> <span class="m">3</span><span class="p">,</span> main <span class="o">=</span> <span class="s">&quot;Gdot Ref. LGU+&quot;</span><span class="p">)</span>
env <span class="o">&lt;-</span> envelope<span class="p">(</span>wfdot.ppp<span class="p">,</span> fun <span class="o">=</span> Gdot<span class="p">,</span> i <span class="o">=</span> <span class="s">&quot;LGU+&quot;</span><span class="p">,</span> nsim <span class="o">=</span> <span class="m">99</span><span class="p">)</span>
plot<span class="p">(</span>env<span class="p">,</span> add <span class="o">=</span> <span class="bp">T</span><span class="p">)</span>

plot<span class="p">(</span>Kdot<span class="p">(</span>wfdot.ppp<span class="p">,</span> <span class="s">&quot;LGU+&quot;</span><span class="p">),</span> lwd <span class="o">=</span> <span class="m">3</span><span class="p">,</span> main <span class="o">=</span> <span class="s">&quot;Kdot Ref. LGU+&quot;</span><span class="p">)</span>
plot<span class="p">(</span>Ldot<span class="p">(</span>wfdot.ppp<span class="p">,</span> <span class="s">&quot;LGU+&quot;</span><span class="p">),</span> lwd <span class="o">=</span> <span class="m">3</span><span class="p">,</span> main <span class="o">=</span> <span class="s">&quot;Ldot Ref. LGU+&quot;</span><span class="p">)</span>
env <span class="o">&lt;-</span> envelope<span class="p">(</span>wfdot.ppp<span class="p">,</span> fun <span class="o">=</span> Kdot<span class="p">,</span> i <span class="o">=</span> <span class="s">&quot;LGU+&quot;</span><span class="p">,</span> nsim <span class="o">=</span> <span class="m">20</span><span class="p">)</span>
plot<span class="p">(</span>env<span class="p">)</span>
env <span class="o">&lt;-</span> envelope<span class="p">(</span>wfdot.ppp<span class="p">,</span> fun <span class="o">=</span> Ldot<span class="p">,</span> i <span class="o">=</span> <span class="s">&quot;LGU+&quot;</span><span class="p">,</span> nsim <span class="o">=</span> <span class="m">20</span><span class="p">)</span>
plot<span class="p">(</span>env<span class="p">)</span>

<span class="c1"># Fit a PPM without marks</span>
d7_q <span class="o">&lt;-</span> d7<span class="p">[</span><span class="kp">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>d7<span class="p">),</span> <span class="m">12389</span><span class="p">,</span> replace <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)]</span>
p1 <span class="o">&lt;-</span> ppm<span class="p">(</span>quadscheme<span class="p">(</span>wfppp<span class="p">)</span> <span class="o">~</span> <span class="m">1</span><span class="p">)</span>
p2 <span class="o">&lt;-</span> ppm<span class="p">(</span>quadscheme<span class="p">(</span>wfppp<span class="p">)</span> <span class="o">~</span> polynom<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span><span class="m">1</span><span class="p">)</span> <span class="o">+</span> checkins <span class="o">+</span> tips<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p3 <span class="o">&lt;-</span> ppm<span class="p">(</span>quadscheme<span class="p">(</span>wfppp<span class="p">)</span> <span class="o">~</span> polynom<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span><span class="m">2</span><span class="p">))</span>
p4 <span class="o">&lt;-</span> ppm<span class="p">(</span>quadscheme<span class="p">(</span>wfppp<span class="p">)</span> <span class="o">~</span> polynom<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> checkins<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p5 <span class="o">&lt;-</span> ppm<span class="p">(</span>quadscheme<span class="p">(</span>wfppp<span class="p">)</span> <span class="o">~</span> polynom<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> users<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p6 <span class="o">&lt;-</span> ppm<span class="p">(</span>quadscheme<span class="p">(</span>wfppp<span class="p">)</span> <span class="o">~</span> polynom<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> tips<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p7 <span class="o">&lt;-</span> ppm<span class="p">(</span>quadscheme<span class="p">(</span>wfppp<span class="p">)</span> <span class="o">~</span> polynom<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> checkins <span class="o">+</span> users<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p8 <span class="o">&lt;-</span> ppm<span class="p">(</span>quadscheme<span class="p">(</span>wfppp<span class="p">)</span> <span class="o">~</span> polynom<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> checkins <span class="o">+</span> tips<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p9 <span class="o">&lt;-</span> ppm<span class="p">(</span>quadscheme<span class="p">(</span>wfppp<span class="p">)</span> <span class="o">~</span> polynom<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> users <span class="o">+</span> tips<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p10 <span class="o">&lt;-</span> ppm<span class="p">(</span>quadscheme<span class="p">(</span>wfppp<span class="p">)</span> <span class="o">~</span> polynom<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> checkins <span class="o">+</span> users <span class="o">+</span> tips<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>

anova<span class="p">(</span>p1<span class="p">,</span> p2<span class="p">,</span> p3<span class="p">,</span> p4<span class="p">,</span> p5<span class="p">,</span> p6<span class="p">,</span> p7<span class="p">,</span> p8<span class="p">,</span> p9<span class="p">,</span> p10<span class="p">,</span> test <span class="o">=</span> <span class="s">&quot;LRT&quot;</span><span class="p">)</span>
AIC<span class="p">(</span>p1<span class="p">)</span>
AIC<span class="p">(</span>p2<span class="p">)</span>
AIC<span class="p">(</span>p3<span class="p">)</span>
AIC<span class="p">(</span>p4<span class="p">)</span>
AIC<span class="p">(</span>p5<span class="p">)</span>
AIC<span class="p">(</span>p6<span class="p">)</span>
AIC<span class="p">(</span>p7<span class="p">)</span>
AIC<span class="p">(</span>p8<span class="p">)</span>
AIC<span class="p">(</span>p9<span class="p">)</span>
AIC<span class="p">(</span>p10<span class="p">)</span>

diagnose.ppm<span class="p">(</span>p1<span class="p">)</span>
diagnose.ppm<span class="p">(</span>p2<span class="p">)</span>
diagnose.ppm<span class="p">(</span>p3<span class="p">)</span>

<span class="c1"># Fit a PPM with the mark</span>
Q
d7_q <span class="o">&lt;-</span> d7<span class="p">[</span><span class="kp">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>d7<span class="p">),</span> <span class="m">37167</span><span class="p">,</span> replace <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)]</span>
wfact <span class="o">&lt;-</span> <span class="kp">as.factor</span><span class="p">(</span>wifi<span class="o">$</span>comp<span class="p">)</span>
wfact <span class="o">&lt;-</span> <span class="kp">as.factor</span><span class="p">(</span>wifi<span class="o">$</span><span class="kp">cat</span><span class="p">)</span>
wfact <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>wifi<span class="p">[,</span><span class="kt">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">2</span><span class="p">)])</span>
wfact <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>wifi<span class="p">[,</span><span class="m">6</span><span class="p">],</span> <span class="m">1</span><span class="o">:</span><span class="m">2385</span><span class="p">))</span>
wfdot.ppp <span class="o">&lt;-</span> ppp<span class="p">(</span>wifi.pts<span class="p">[,</span><span class="m">1</span><span class="p">],</span> wifi.pts<span class="p">[,</span><span class="m">2</span><span class="p">],</span> 
                 xrange <span class="o">=</span> <span class="kp">range</span><span class="p">(</span>wifi.poly<span class="p">[,</span><span class="m">1</span><span class="p">]),</span>
                 yrange <span class="o">=</span> <span class="kp">range</span><span class="p">(</span>wifi.poly<span class="p">[,</span><span class="m">2</span><span class="p">]),</span>
                 marks <span class="o">=</span> wfact<span class="p">)</span>

Q <span class="o">&lt;-</span> quadscheme<span class="p">(</span>wfdot.ppp<span class="p">)</span>
p1 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> <span class="m">1</span><span class="p">)</span>
p2 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> polynom<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> <span class="m">1</span><span class="p">))</span>
p3 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> marks<span class="p">)</span>
p4 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> marks <span class="o">+</span> polynom<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> <span class="m">1</span><span class="p">))</span>
p5 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> marks <span class="o">+</span> polynom<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> <span class="m">2</span><span class="p">))</span>
p6 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> marks <span class="o">+</span> polynom<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> checkins<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p7 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> marks <span class="o">+</span> polynom<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> users<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p8 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> marks <span class="o">+</span> polynom<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> tips<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p9 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> marks <span class="o">+</span> polynom<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> checkins <span class="o">+</span> users<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p10 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> marks <span class="o">+</span> polynom<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> checkins <span class="o">+</span> tips<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p11 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> marks <span class="o">+</span> polynom<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> users <span class="o">+</span> tips<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
p12 <span class="o">&lt;-</span> ppm<span class="p">(</span>Q <span class="o">~</span> marks <span class="o">+</span> polynom<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> checkins <span class="o">+</span> users <span class="o">+</span> tips<span class="p">,</span> data <span class="o">=</span> d7_q<span class="p">)</span>
<span class="c1"># p13 &lt;- ppm(Q ~ marks + polynom(x, y, 1) + checkins + users + tips + cat, data = d7_q)</span>

anova<span class="p">(</span>p1<span class="p">,</span> p2<span class="p">,</span> p3<span class="p">,</span> p4<span class="p">,</span> p5<span class="p">,</span> p6<span class="p">,</span> p7<span class="p">,</span> p8<span class="p">,</span> p9<span class="p">,</span> p10<span class="p">,</span> p11<span class="p">,</span> p12<span class="p">,</span> test <span class="o">=</span> <span class="s">&quot;LRT&quot;</span><span class="p">)</span>
AIC<span class="p">(</span>p1<span class="p">)</span>
AIC<span class="p">(</span>p2<span class="p">)</span>
AIC<span class="p">(</span>p3<span class="p">)</span>
AIC<span class="p">(</span>p4<span class="p">)</span>
AIC<span class="p">(</span>p5<span class="p">)</span>
AIC<span class="p">(</span>p6<span class="p">)</span>
AIC<span class="p">(</span>p7<span class="p">)</span>
AIC<span class="p">(</span>p8<span class="p">)</span>
AIC<span class="p">(</span>p9<span class="p">)</span>
AIC<span class="p">(</span>p10<span class="p">)</span>
AIC<span class="p">(</span>p11<span class="p">)</span>
AIC<span class="p">(</span>p12<span class="p">)</span>

wt.pts <span class="o">&lt;-</span> as.points<span class="p">(</span><span class="kp">as.numeric</span><span class="p">(</span>d7_q<span class="p">[,</span><span class="m">3</span><span class="p">]),</span> <span class="kp">as.numeric</span><span class="p">(</span>d7_q<span class="p">[,</span><span class="m">2</span><span class="p">]))</span>
wt.pts <span class="o">&lt;-</span> <span class="kp">as.matrix</span><span class="p">(</span>wt.pts<span class="p">)</span>
wfact <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span>d7_q<span class="o">$</span>checkins<span class="p">)</span>
wfact <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span>d7_q<span class="o">$</span>users<span class="p">)</span>
wfact <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span>d7_q<span class="o">$</span>tips<span class="p">)</span>
wt.ppp <span class="o">&lt;-</span> ppp<span class="p">(</span>wt.pts<span class="p">[,</span><span class="m">1</span><span class="p">],</span> wt.pts<span class="p">[,</span><span class="m">2</span><span class="p">],</span> 
              xrange <span class="o">=</span> <span class="kp">range</span><span class="p">(</span>wifi.poly<span class="p">[,</span><span class="m">1</span><span class="p">]),</span>
              yrange <span class="o">=</span> <span class="kp">range</span><span class="p">(</span>wifi.poly<span class="p">[,</span><span class="m">2</span><span class="p">]),</span>
              marks <span class="o">=</span> wfact<span class="p">)</span>
plot<span class="p">(</span>density<span class="p">(</span>wt.ppp<span class="p">),</span> bandwidth <span class="o">=</span> <span class="m">5</span><span class="p">)</span>

par<span class="p">(</span>mfrow <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
seoul_map <span class="o">&lt;-</span> qmap<span class="p">(</span><span class="s">&#39;seoul&#39;</span><span class="p">,</span> zoom <span class="o">=</span> <span class="m">11</span><span class="p">,</span> maptype <span class="o">=</span> <span class="s">&#39;roadmap&#39;</span><span class="p">)</span>
p <span class="o">&lt;-</span> seoul_map <span class="o">+</span> 
  geom_point<span class="p">(</span>data <span class="o">=</span> wifi<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> lng<span class="p">,</span> y <span class="o">=</span> lat<span class="p">,</span> colour <span class="o">=</span> comp<span class="p">))</span> <span class="o">+</span>
  facet_wrap<span class="p">(</span><span class="o">~</span>comp<span class="p">)</span>
plot<span class="p">(</span>p<span class="p">)</span>

q <span class="o">&lt;-</span> seoul_map <span class="o">+</span> 
  geom_polygon<span class="p">(</span>data <span class="o">=</span> wpt<span class="p">,</span>
               aes<span class="p">(</span>x <span class="o">=</span> lng<span class="p">,</span> y <span class="o">=</span> lat<span class="p">,</span> fill <span class="o">=</span> <span class="m">..</span>level..<span class="p">),</span>
               stat <span class="o">=</span> <span class="s">&#39;density2d&#39;</span><span class="p">,</span>
               alpha <span class="o">=</span> <span class="m">0.3</span><span class="p">)</span> <span class="o">+</span>
  theme<span class="p">(</span>legend.position <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0.92</span><span class="p">,</span> <span class="m">0.85</span><span class="p">),</span>
        legend.background <span class="o">=</span> element_rect<span class="p">(</span>fill <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">,</span>
                                         size <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span>
                                         linetype <span class="o">=</span> <span class="s">&quot;solid&quot;</span><span class="p">))</span>
plot<span class="p">(</span><span class="kp">q</span><span class="p">)</span>

<span class="c1">## INCLUDE THIS PLOT IN THE SLIDES</span>
p2 <span class="o">&lt;-</span> seoul_map <span class="o">+</span> 
  geom_point<span class="p">(</span>data <span class="o">=</span> wifi<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> lng<span class="p">,</span> y <span class="o">=</span> lat<span class="p">,</span> colour <span class="o">=</span> comp<span class="p">))</span> <span class="o">+</span>
  facet_wrap<span class="p">(</span><span class="o">~</span><span class="kp">cat</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1">#facet_wrap(~comp) + </span>
  scale_colour_discrete<span class="p">(</span>name <span class="o">=</span> <span class="s">&quot;Wi-Fi Providers&quot;</span><span class="p">)</span> <span class="o">+</span>
  theme<span class="p">(</span>panel.border <span class="o">=</span> element_rect<span class="p">(</span>color <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">,</span> fill <span class="o">=</span> <span class="kc">NA</span><span class="p">,</span> size <span class="o">=</span> <span class="m">1</span><span class="p">),</span>
        <span class="c1">#legend.position = &quot;none&quot;,</span>
        strip.text.x <span class="o">=</span> element_text<span class="p">(</span>size <span class="o">=</span> <span class="m">12</span><span class="p">))</span>
plot<span class="p">(</span>p2<span class="p">)</span>

p3 <span class="o">&lt;-</span> seoul_map <span class="o">+</span> 
  geom_polygon<span class="p">(</span>data <span class="o">=</span> wifi<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> lng<span class="p">,</span> y <span class="o">=</span> lat<span class="p">,</span> fill <span class="o">=</span> <span class="m">..</span>level..<span class="p">,</span> colour <span class="o">=</span> comp<span class="p">),</span>
               stat <span class="o">=</span> <span class="s">&#39;density2d&#39;</span><span class="p">,</span>
               alpha <span class="o">=</span> <span class="m">0.3</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1">#facet_wrap(~cat) +</span>
  facet_wrap<span class="p">(</span><span class="o">~</span>comp<span class="p">)</span> <span class="o">+</span> 
  scale_colour_discrete<span class="p">(</span>name <span class="o">=</span> <span class="s">&quot;Wi-Fi Providers&quot;</span><span class="p">)</span> <span class="o">+</span>
  theme<span class="p">(</span>panel.border <span class="o">=</span> element_rect<span class="p">(</span>color <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">,</span> fill <span class="o">=</span> <span class="kc">NA</span><span class="p">,</span> size <span class="o">=</span> <span class="m">1</span><span class="p">),</span>
        legend.position <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">,</span>
        strip.text.x <span class="o">=</span> element_text<span class="p">(</span>size <span class="o">=</span> <span class="m">16</span><span class="p">))</span>
plot<span class="p">(</span>p3<span class="p">)</span>

q2 <span class="o">&lt;-</span> seoul_map <span class="o">+</span> 
  geom_polygon<span class="p">(</span>data <span class="o">=</span> wifi<span class="p">,</span>
               aes<span class="p">(</span>x <span class="o">=</span> lng<span class="p">,</span> y <span class="o">=</span> lat<span class="p">,</span> fill <span class="o">=</span> <span class="m">..</span>level..<span class="p">,</span> colour <span class="o">=</span> comp<span class="p">),</span>
               stat <span class="o">=</span> <span class="s">&#39;density2d&#39;</span><span class="p">,</span>
               alpha <span class="o">=</span> <span class="m">0.3</span><span class="p">)</span> <span class="o">+</span>
  facet_wrap<span class="p">(</span><span class="o">~</span><span class="kp">cat</span><span class="p">)</span>
plot<span class="p">(</span>q2<span class="p">)</span>

q3 <span class="o">&lt;-</span> seoul_map <span class="o">+</span>
  geom_polygon<span class="p">(</span>data <span class="o">=</span> wifi<span class="p">,</span> 
               aes<span class="p">(</span>x <span class="o">=</span> lng<span class="p">,</span> y <span class="o">=</span> lat<span class="p">,</span> fill <span class="o">=</span> <span class="m">..</span>level..<span class="p">),</span>
               stat <span class="o">=</span> <span class="s">&#39;density2d&#39;</span><span class="p">,</span>
               alpha <span class="o">=</span> <span class="m">0.3</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1">#scale_fill_gradient(low = &#39;#C6DBEF&#39;,</span>
  <span class="c1">#                    high = &#39;#08306B&#39;) +</span>
  facet_wrap<span class="p">(</span><span class="o">~</span>comp<span class="p">)</span>
plot<span class="p">(</span>q3<span class="p">)</span>
</pre></div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://stathwang.github.io/tag/point-process-models.html">point process models</a>
      <a href="https://stathwang.github.io/tag/spatial-statistics.html">spatial statistics</a>
      <a href="https://stathwang.github.io/tag/r.html">r</a>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'thedatalogical';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <hr />
    <p />
    <!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
  #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//github.us1.list-manage.com/subscribe/post?u=0f2c943c221c777ef88591fb6&amp;id=6cf4236c90" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
  <label for="mce-EMAIL">Subscribe to my sporadic data science newsletter and blog post</label>
  <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_0f2c943c221c777ef88591fb6_6cf4236c90" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<br />
<br />

<!--End mc_embed_signup-->

    <footer>
<p>
  &copy; Seong Hyun Hwang 2015 - 2017 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69797568-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
  <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us1.list-manage.com","uuid":"0f2c943c221c777ef88591fb6","lid":"6cf4236c90"}) })</script>



<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//" + stathwang.piwikpro.com + "/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//bnjbvr.alwaysdata.net/piwik/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Seong Hyun Hwang ",
  "url" : "https://stathwang.github.io",
  "image": "http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg",
  "description": "Seong Hyun Hwang's Thoughts and Writings"
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Predicting Free Public WiFi Locations in Seoul with Point Process Models",
  "headline": "Predicting Free Public WiFi Locations in Seoul with Point Process Models",
  "datePublished": "2017-06-24 23:45:00-04:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Seong Hyun Hwang",
    "url": "https://stathwang.github.io/author/seong-hyun-hwang.html"
  },
  "image": "http://www.gravatar.com/avatar/ea0e94239070aef9781e64fb53facf13?s=120&d=http%3A%2F%2Fwww.example.com%2Fdefault.jpg",
  "url": "https://stathwang.github.io/drafts/predicting-free-public-wifi-locations-in-seoul-with-point-process-models.html",
  "description": "The field of spatial statistics is still quite new although many frequentist methods have been developed many years ago. In this post, I'm going to model free public WiFi locations in Seoul, Korea and predict Load the dataset of free public WiFi locations in Seoul, Korea. The dataset consists of …"
}
</script></body>
</html>